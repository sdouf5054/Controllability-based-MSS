# FLX4-Net v3.1-lite Track A Configuration
# ==========================================

# === Paths ===
paths:
  musdb_root: "/path/to/musdb18"  # Update this to your MUSDB18 path
  output_root: "./outputs"
  cache_root: "./cache"
  metadata_root: "./metadata"
  tables_root: "./tables"
  results_root: "./results"

# === Audio ===
audio:
  sample_rate: 44100
  mono: true

# === Segmentation ===
# Window N = 3.0s, Hop H = 1.5s (50% overlap)
segmentation:
  window_sec: 3.0
  hop_sec: 1.5

# === Silence ===
# Policy: flag_and_separate
# - Primary analysis: is_silent=False only
# - Supplementary: is_silent=True separately
silence:
  initial_threshold_db: -40
  calibration_method: "gap_or_5th_percentile"  # "gap_or_5th_percentile" | "fixed"
  percentile_cutoff: 5  # Used when no clear gap found

# === Separator ===
separator:
  name: "demucs"
  model: "htdemucs"
  output_alignment: "truncate_to_shorter"
  max_length_diff_samples: 1000  # ~23ms at 44.1kHz, warn if exceeded

# === Beat Tracking ===
# Priority: essentia > madmom > librosa
beat_tracking:
  backend: "essentia"  # "essentia" | "madmom" | "librosa"
  
  # Track-level unavailability rules
  min_beats_per_track: 8
  
  # Segment-level unavailability
  min_beats_per_segment: 2
  
  # Essentia-specific
  essentia:
    min_confidence: 0.1
  
  # madmom fallback rules
  madmom:
    min_beats_per_minute: 0.5
    max_ibi_cv: 0.5  # coefficient of variation threshold

# === Cues ===
cues:
  # Similarity backend for r(t), s(t)
  similarity:
    n_mels: 128
    n_fft: 2048
    hop_length: 512
    fmin: 20
    fmax: 8000
    pooling: "mean"  # "mean" | "median"
    normalize: "l2"
    metric: "cosine"
  
  # Repetition r(t): short-term, past 12s only
  repetition:
    max_lookback_sec: 12.0
    aggregation: "max"  # "max" | "top_k_mean"
    top_k: 3
  
  # Structure s(t): long-range, >= 30s distance only
  structure:
    min_distance_sec: 30.0
    aggregation: "top_k_mean"
    top_k: 3
  
  # Beat synchrony b(t)
  beat_sync:
    tolerance_sec: 0.070  # Â±70ms
  
  # Processing p(t): weak auxiliary cue
  processing:
    enabled: true

# === Difficulty Metrics ===
metrics:
  # Primary: SI-SDR, Reference: SDR
  primary: "sisdr"
  compute_sdr: true  # Also compute SDR for reference

# === Analysis ===
analysis:
  # Correlation method for proxy association
  correlation_method: "spearman"
  
  # Figure settings
  figure_format: "png"
  figure_dpi: 150
